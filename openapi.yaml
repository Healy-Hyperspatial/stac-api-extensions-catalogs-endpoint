openapi: 3.0.3
info:
  title: STAC API Catalogs Endpoint Extension
  version: 1.0.0-proposal
  description: |
    An extension that adds a dedicated `/catalogs` endpoint to support a federated 
    "Hub and Spoke" model. It allows a STAC API to act as a registry for multiple 
    independent sub-catalogs without altering the standard behavior of the API Root.
    
    Includes "Safety-First" transaction logic where deletions via this endpoint 
    are strictly organizational (unlinking) and never destructive to data.
paths:
  # ----------------------------------------------------------------------
  # 1. THE REGISTRY LIST (Root Catalogs)
  # ----------------------------------------------------------------------
  /catalogs:
    get:
      summary: List available sub-catalogs
      operationId: getCatalogs
      responses:
        '200':
          description: A list of catalogs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogsList'
    post:
      summary: Register a new Root Catalog
      operationId: createCatalog
      requestBody:
        description: The Catalog definition
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Catalog'
      responses:
        '201':
          description: Catalog created successfully
          headers:
            Location:
              description: The location of the created catalog
              schema:
                type: string

  # ----------------------------------------------------------------------
  # 2. THE SUB-CATALOG LANDING PAGE & DISBAND
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}:
    parameters:
      - $ref: '#/components/parameters/catalogId'
    get:
      summary: Get the Landing Page for a specific sub-catalog
      operationId: getCatalog
      responses:
        '200':
          description: A STAC Landing Page scoped to this catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LandingPage'
    delete:
      summary: Disband a Catalog
      description: |
        Deletes the Catalog resource. All child collections and sub-catalogs are 
        UNLINKED but NOT DELETED. Orphaned children are adopted by the root.
      operationId: deleteCatalog
      responses:
        '204':
          description: Catalog deleted (disbanded) successfully

  # ----------------------------------------------------------------------
  # 3. SUB-CATALOG MANAGEMENT (Hierarchy)
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/catalogs:
    parameters:
      - $ref: '#/components/parameters/catalogId'
    get:
      summary: List sub-catalogs of this catalog
      description: Returns only the child catalogs (hierarchy traversal).
      operationId: getSubCatalogs
      responses:
        '200':
          description: A list of sub-catalogs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogsList'
    post:
      summary: Create a Sub-Catalog
      description: Creates a new catalog and links it as a child of {catalogId}.
      operationId: createSubCatalog
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Catalog'
      responses:
        '201':
          description: Sub-Catalog created and linked

  /catalogs/{catalogId}/catalogs/{subCatalogId}:
    parameters:
      - $ref: '#/components/parameters/catalogId'
      - $ref: '#/components/parameters/subCatalogId'
    delete:
      summary: Unlink a Sub-Catalog
      description: |
        Removes the link between the parent and sub-catalog. 
        The sub-catalog resource is NOT deleted.
      operationId: unlinkSubCatalog
      responses:
        '204':
          description: Sub-Catalog unlinked successfully

  # ----------------------------------------------------------------------
  # 4. CHILDREN EXTENSION (Mixed Content)
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/children:
    parameters:
      - $ref: '#/components/parameters/catalogId'
      - name: type
        in: query
        description: Filter children by type (Catalog or Collection)
        schema:
          type: string
          enum: [Catalog, Collection]
    get:
      summary: Get all children (Catalogs and Collections)
      operationId: getCatalogChildren
      responses:
        '200':
          description: A list of child resources
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChildrenList'

  # ----------------------------------------------------------------------
  # 5. SUB-CATALOG CONFORMANCE
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/conformance:
    parameters:
      - $ref: '#/components/parameters/catalogId'
    get:
      summary: Get conformance classes for this specific sub-catalog
      operationId: getCatalogConformance
      responses:
        '200':
          description: STAC/OGC Conformance classes
          content:
            application/json:
              schema:
                type: object

  # ----------------------------------------------------------------------
  # 6. SCOPED COLLECTIONS MANAGEMENT
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/collections:
    parameters:
      - $ref: '#/components/parameters/catalogId'
    get:
      summary: List collections within a specific sub-catalog
      operationId: getCatalogCollections
      responses:
        '200':
          description: A STAC Collections object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Collections'
    post:
      summary: Create a Collection in this Catalog
      description: Creates a collection and links it as a child of {catalogId}.
      operationId: createCatalogCollection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Collection'
      responses:
        '201':
          description: Collection created and linked

  # ----------------------------------------------------------------------
  # 7. SCOPED SINGLE COLLECTION
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/collections/{collectionId}:
    parameters:
      - $ref: '#/components/parameters/catalogId'
      - $ref: '#/components/parameters/collectionId'
    get:
      summary: Get a specific collection definition
      operationId: getCatalogCollection
      responses:
        '200':
          description: A STAC Collection object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Collection'
    delete:
      summary: Unlink a Collection
      description: |
        Removes the link between the catalog and collection. 
        The Collection data is NEVER deleted via this route.
      operationId: unlinkCatalogCollection
      responses:
        '204':
          description: Collection unlinked successfully

  # ----------------------------------------------------------------------
  # 8. SCOPED ITEMS (Search)
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/collections/{collectionId}/items:
    parameters:
      - $ref: '#/components/parameters/catalogId'
      - $ref: '#/components/parameters/collectionId'
    get:
      summary: Get items from a collection within a sub-catalog
      operationId: getCatalogCollectionItems
      responses:
        '200':
          description: A STAC FeatureCollection
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureCollection'

  # ----------------------------------------------------------------------
  # 9. SCOPED SINGLE ITEM
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/collections/{collectionId}/items/{itemId}:
    parameters:
      - $ref: '#/components/parameters/catalogId'
      - $ref: '#/components/parameters/collectionId'
      - name: itemId
        in: path
        required: true
        schema: 
          type: string
    get:
      summary: Get a single item
      operationId: getCatalogItem
      responses:
        '200':
          description: A STAC Item (Feature)
          content:
            application/geo+json:
              schema:
                $ref: '#/components/schemas/Item'

  # ----------------------------------------------------------------------
  # 10. SUB-CATALOG QUERYABLES (Optional)
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/queryables:
    parameters:
      - $ref: '#/components/parameters/catalogId'
    get:
      summary: Get queryable fields for this sub-catalog
      operationId: getCatalogQueryables
      responses:
        '200':
          description: A JSON Schema of queryable fields
          content:
            application/schema+json:
              schema:
                $ref: '#/components/schemas/Queryables'

  # ----------------------------------------------------------------------
  # 11. SCOPED COLLECTION QUERYABLES
  # ----------------------------------------------------------------------
  /catalogs/{catalogId}/collections/{collectionId}/queryables:
    parameters:
      - $ref: '#/components/parameters/catalogId'
      - $ref: '#/components/parameters/collectionId'
    get:
      summary: Get queryable fields for a specific collection
      operationId: getCatalogCollectionQueryables
      responses:
        '200':
          description: A JSON Schema of queryable fields
          content:
            application/schema+json:
              schema:
                $ref: '#/components/schemas/Queryables'

components:
  parameters:
    catalogId:
      name: catalogId
      in: path
      description: The unique identifier of the sub-catalog
      required: true
      schema:
        type: string
    subCatalogId:
      name: subCatalogId
      in: path
      description: The unique identifier of the child sub-catalog
      required: true
      schema:
        type: string
    collectionId:
      name: collectionId
      in: path
      description: The unique identifier of the collection
      required: true
      schema:
        type: string

  schemas:
    CatalogsList:
      type: object
      required:
        - catalogs
        - links
      properties:
        catalogs:
          type: array
          items:
            $ref: '#/components/schemas/Catalog'
        links:
          type: array
          items:
            $ref: '#/components/schemas/Link'
    
    ChildrenList:
      type: object
      required:
        - children
        - links
      properties:
        children:
          type: array
          items:
            # Polymorphic schema (can be Catalog or Collection)
            type: object 
        links:
          type: array
          items:
            $ref: '#/components/schemas/Link'

    # Placeholders for Standard STAC Objects
    Catalog:
      type: object
      description: A standard STAC Catalog object
    LandingPage:
      type: object
      description: A standard STAC Landing Page object
    Collections:
      type: object
      description: A standard STAC Collections object
    Collection:
      type: object
      description: A standard STAC Collection object
    FeatureCollection:
      type: object
      description: A GeoJSON FeatureCollection
    Item:
      type: object
      description: A STAC Item
    Link:
      type: object
      required:
        - rel
        - href
      properties:
        rel:
          type: string
        href:
          type: string
      Queryables:
        type: object
        description: A JSON Schema object for queryables
